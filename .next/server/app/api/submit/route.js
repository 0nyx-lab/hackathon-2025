"use strict";(()=>{var e={};e.id=499,e.ids=[499],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8446:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{OPTIONS:()=>h,POST:()=>g});var n=r(9303),o=r(8716),i=r(670),s=r(7070),c=r(8990);let l={continuity:[{level:1,name:"継続力★1",condition:"3日連続完了",days:3},{level:2,name:"継続力★2",condition:"7日連続完了",days:7},{level:3,name:"継続力★3",condition:"14日連続完了",days:14},{level:4,name:"継続力★4",condition:"30日連続完了",days:30},{level:5,name:"継続力★5",condition:"100日連続完了",days:100}],challenge:[{level:1,name:"挑戦性★1",condition:"1週間で2カテゴリ以上実行",categories:2},{level:2,name:"挑戦性★2",condition:"1週間で3カテゴリ以上実行",categories:3},{level:3,name:"挑戦性★3",condition:"1週間で4カテゴリ実行",categories:4},{level:4,name:"挑戦性★4",condition:"1ヶ月で全カテゴリ実行",categories:4,period:"month"},{level:5,name:"挑戦性★5",condition:"継続的に全カテゴリ実行",categories:4,period:"ongoing"}],balance:[{level:1,name:"バランス力★1",condition:"1週間で3カテゴリ以上実行",categories:3},{level:2,name:"バランス力★2",condition:"バランススコア0.8以上",score:.8},{level:3,name:"バランス力★3",condition:"バランススコア1.2以上",score:1.2},{level:4,name:"バランス力★4",condition:"バランススコア1.5以上",score:1.5},{level:5,name:"バランス力★5",condition:"バランススコア2.0以上",score:2}]};async function u(e,t,r){let a=[],n=await (0,c.ro)(e);return a.push(...await d(e,n)),a.push(...await _(e,n,r)),a.push(...await m(e,n,r)),a}async function d(e,t){let r=[],a=await p(e);for(let n of l.continuity)!t.some(e=>"continuity"===e.badge_type&&e.level===n.level)&&a>=n.days&&(await (0,c.Wr)({user_id:e,badge_type:"continuity",level:n.level,earned_at:new Date().toISOString(),metadata:{consecutive_days:a}}),r.push(n.name));return r}async function _(e,t,r){let a=[];if(!r)return a;let n=new Date;n.setDate(n.getDate()-7);let o=new Set(r.filter(e=>new Date(e.date)>=n&&e.activity_count>0).map(e=>e.category_id)).size;for(let r of l.challenge)!t.some(e=>"challenge"===e.badge_type&&e.level===r.level)&&o>=r.categories&&(await (0,c.Wr)({user_id:e,badge_type:"challenge",level:r.level,earned_at:new Date().toISOString(),metadata:{active_categories:o}}),a.push(r.name));return a}async function m(e,t,r){let a=[];if(!r)return a;let n=function(e){let t=new Map;for(let r of e){let e=t.get(r.category_id)||0;t.set(r.category_id,e+r.activity_count)}let r=Array.from(t.values()).reduce((e,t)=>e+t,0);if(0===r)return 0;let a=0;for(let e of t.values()){let t=e/r;t>0&&(a-=t*Math.log2(t))}return a}(r),o=new Date;o.setDate(o.getDate()-7);let i=new Set(r.filter(e=>new Date(e.date)>=o&&e.activity_count>0).map(e=>e.category_id)).size;for(let r of l.balance){if(t.some(e=>"balance"===e.badge_type&&e.level===r.level))continue;let o=!1;r.categories&&i>=r.categories?o=!0:r.score&&n>=r.score&&(o=!0),o&&(await (0,c.Wr)({user_id:e,badge_type:"balance",level:r.level,earned_at:new Date().toISOString(),metadata:{balance_score:n,active_categories:i}}),a.push(r.name))}return a}async function p(e){return Math.floor(10*Math.random())+1}async function g(e){try{let{task_id:r,duration_seconds:a,result:n,timestamp:o}=await e.json();if(!r||!a||!n||!o)return s.NextResponse.json({error:"Bad Request",message:"必須パラメータが不足しています",status:400},{status:400});try{var t;let i=e.nextUrl.searchParams.get("user_id")||"demo_user_001",l=await (0,c.ym)({user_id:i,category_id:r.includes("learning")||r.includes("学習")?"learning":r.includes("work")||r.includes("仕事")?"work":r.includes("life")||r.includes("生活")?"life":r.includes("health")||r.includes("健康")?"health":"learning",task_title:{mock_learning_001:"英単語1個覚える",mock_learning_002:"プログラミング概念",mock_health_001:"朝のストレッチ",mock_health_002:"深呼吸",mock_work_001:"効率化アイデア",mock_work_002:"スキルアップ計画",mock_life_001:"整理整頓",mock_life_002:"今日の振り返り"}[r]||"1分タスク",task_description:{mock_learning_001:"今日覚える英単語を1つ選んで記憶に定着させましょう",mock_learning_002:"新しいプログラミング概念を1つ学びましょう",mock_health_001:"1分間の軽いストレッチで体を目覚めさせましょう",mock_health_002:"1分間の深呼吸でリラックスしましょう",mock_work_001:"現在の作業を効率化する方法を1つ考えてみましょう",mock_work_002:"今週身につけたいスキルを1つ選んで計画を立てましょう",mock_life_001:"デスク周りを1分間で整理しましょう",mock_life_002:"今日学んだことを1つ振り返ってまとめましょう"}[r]||"1分間の成長アクション",started_at:new Date(Date.now()-1e3*a).toISOString(),completed_at:o,duration_seconds:a,result_data:{completed:n.completed,confidence:n.confidence},source:"app"});if(!l)throw Error("Failed to create activity");let d=new Date().toISOString().split("T")[0];await (0,c.C7)({user_id:i,date:d,category_id:l.category_id,total_minutes:Math.ceil(a/60),activity_count:1,streak_days:Math.floor(10*Math.random())+1,balance_score:0});let _=await u(i,l),m={success:!0,badges_earned:_,streak_updated:Math.floor(10*Math.random())+1,next_suggestion:(t=_.length,n.completed?t>0?`おめでとうございます！新しいバッジを獲得しました！`:"今日の目標達成まで残り2分です！":"次回は必ず成功させましょう！")};return s.NextResponse.json(m)}catch(t){console.warn("Primary submit failed, using mock response:",t);let e={success:!0,badges_earned:n.completed?["daily_step"]:[],streak_updated:Math.floor(10*Math.random())+1,next_suggestion:n.completed?"今日の目標達成まで残り2分です！":"次回は必ず成功させましょう！"};return s.NextResponse.json(e)}}catch(e){return console.error("Submit API Error:",e),s.NextResponse.json({error:"Internal Server Error",message:"タスク送信に失敗しました",status:500},{status:500})}}async function h(){return new s.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/submit/route",pathname:"/api/submit",filename:"route",bundlePath:"app/api/submit/route"},resolvedPagePath:"C:\\AI\\workspaces\\cursor-aidd-sandbox\\hackathon-2025\\src\\app\\api\\submit\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:w,serverHooks:v}=f,k="/api/submit/route";function S(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}},8990:(e,t,r)=>{r.d(t,{C7:()=>u,N1:()=>i,PR:()=>n,Wr:()=>l,cq:()=>o,ro:()=>s,ym:()=>c});var a=r(7982);async function n(e){try{let{data:t,error:r}=await a.p.from("users").select("*").eq("id",e).single();if(r)throw r;return t}catch(e){return console.error("getUser error:",e),null}}async function o(e,t){try{let r=new Date;r.setDate(r.getDate()-t);let{data:n,error:o}=await a.p.from("activities").select("*").eq("user_id",e).gte("completed_at",r.toISOString()).order("completed_at",{ascending:!1});if(o)throw o;return n||[]}catch(e){return console.error("getRecentActivities error:",e),[]}}async function i(e,t){try{let r=new Date;r.setDate(r.getDate()-t);let{data:n,error:o}=await a.p.from("growth_metrics").select("*").eq("user_id",e).gte("date",r.toISOString().split("T")[0]).order("date",{ascending:!1});if(o)throw o;return n||[]}catch(e){return console.error("getGrowthMetrics error:",e),[]}}async function s(e){try{let{data:t,error:r}=await a.p.from("badges").select("*").eq("user_id",e).order("earned_at",{ascending:!1});if(r)throw r;return t||[]}catch(e){return console.error("getBadges error:",e),[]}}async function c(e){try{let{data:t,error:r}=await a.p.from("activities").insert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("createActivity error:",e),null}}async function l(e){try{let{data:t,error:r}=await a.p.from("badges").insert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("createBadge error:",e),null}}async function u(e){try{let{data:t,error:r}=await a.p.from("growth_metrics").upsert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("updateGrowthMetrics error:",e),null}}},7982:(e,t,r)=>{r.d(t,{p:()=>s});let a=require("@supabase/supabase-js"),n=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-key",i=process.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-key";(0,a.createClient)(n,o);let s=(0,a.createClient)(n,i,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(8446));module.exports=a})();