"use strict";(()=>{var e={};e.id=707,e.ids=[707],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4901:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d,OPTIONS:()=>p});var n=r(9303),s=r(8716),o=r(670),i=r(7070),c=r(8990),l=r(255);async function d(e){try{let t=e.nextUrl.searchParams.get("user_id")||"demo_user_001";try{let e=await (0,c.PR)(t);if(!e)throw Error("User not found");let r=await (0,c.cq)(t,7),a=await (0,c.N1)(t,7),n=await (0,c.ro)(t),s=await u(e,r,a,n);return i.NextResponse.json(s)}catch(t){console.warn("Primary dashboard failed, using mock data:",t);let e=(0,l.kO)();return i.NextResponse.json(e)}}catch(e){return console.error("Dashboard API Error:",e),i.NextResponse.json({error:"Internal Server Error",message:"ダッシュボードデータ取得に失敗しました",status:500},{status:500})}}async function u(e,t,r,a){let n=new Date().toISOString().split("T")[0],s=t.filter(e=>e.completed_at.startsWith(n)),o=s.reduce((e,t)=>e+Math.ceil((t.duration_seconds||60)/60),0),i=[...new Set(s.map(e=>e.category_id))];return{daily_summary:{total_minutes:o,categories_active:i,streak_days:await function(e){if(0===e.length)return 0;let t=0,r=new Date;r.setHours(0,0,0,0);let a=[...new Set(e.sort((e,t)=>new Date(t.completed_at).getTime()-new Date(e.completed_at).getTime()).map(e=>new Date(e.completed_at).toISOString().split("T")[0]))];for(let e=0;e<a.length;e++){let n=new Date(a[e]),s=new Date(r);if(s.setDate(r.getDate()-t),n.toISOString().split("T")[0]===s.toISOString().split("T")[0])t++;else if(0===e&&n.toISOString().split("T")[0]===r.toISOString().split("T")[0])t=1;else break}return t}(t)},weekly_trend:function(e){let t=[];for(let r=6;r>=0;r--){let a=new Date;a.setDate(a.getDate()-r);let n=a.toISOString().split("T")[0],s=e.filter(e=>e.date===n).reduce((e,t)=>e+t.total_minutes,0);t.push({date:n,minutes:s})}return t}(r),badges:{continuity:a.filter(e=>"continuity"===e.badge_type).length,challenge:a.filter(e=>"challenge"===e.badge_type).length,balance:a.filter(e=>"balance"===e.badge_type).length}}}async function p(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"C:\\AI\\workspaces\\cursor-aidd-sandbox\\hackathon-2025\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:_}=g,f="/api/dashboard/route";function y(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},8990:(e,t,r)=>{r.d(t,{C7:()=>d,N1:()=>o,PR:()=>n,Wr:()=>l,cq:()=>s,ro:()=>i,ym:()=>c});var a=r(7982);async function n(e){try{let{data:t,error:r}=await a.p.from("users").select("*").eq("id",e).single();if(r)throw r;return t}catch(e){return console.error("getUser error:",e),null}}async function s(e,t){try{let r=new Date;r.setDate(r.getDate()-t);let{data:n,error:s}=await a.p.from("activities").select("*").eq("user_id",e).gte("completed_at",r.toISOString()).order("completed_at",{ascending:!1});if(s)throw s;return n||[]}catch(e){return console.error("getRecentActivities error:",e),[]}}async function o(e,t){try{let r=new Date;r.setDate(r.getDate()-t);let{data:n,error:s}=await a.p.from("growth_metrics").select("*").eq("user_id",e).gte("date",r.toISOString().split("T")[0]).order("date",{ascending:!1});if(s)throw s;return n||[]}catch(e){return console.error("getGrowthMetrics error:",e),[]}}async function i(e){try{let{data:t,error:r}=await a.p.from("badges").select("*").eq("user_id",e).order("earned_at",{ascending:!1});if(r)throw r;return t||[]}catch(e){return console.error("getBadges error:",e),[]}}async function c(e){try{let{data:t,error:r}=await a.p.from("activities").insert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("createActivity error:",e),null}}async function l(e){try{let{data:t,error:r}=await a.p.from("badges").insert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("createBadge error:",e),null}}async function d(e){try{let{data:t,error:r}=await a.p.from("growth_metrics").upsert([e]).select().single();if(r)throw r;return t}catch(e){return console.error("updateGrowthMetrics error:",e),null}}},255:(e,t,r)=>{r.d(t,{fs:()=>n,kO:()=>s});let a={today:{user_id:"demo_user_001",cards:[{id:"mock_learning_001",category:"学習",title:"英単語1個覚える",description:"今日覚える英単語を1つ選んで記憶に定着させましょう",estimated_seconds:60,difficulty:"easy",content:"Innovation = 革新、新しいアイデアや方法を生み出すこと"},{id:"mock_health_001",category:"健康",title:"朝のストレッチ",description:"1分間の軽いストレッチで体を目覚めさせましょう",estimated_seconds:60,difficulty:"easy",content:"首回し、肩回し、背伸びをゆっくりと行う"},{id:"mock_work_001",category:"仕事",title:"効率化アイデア",description:"現在の作業を効率化する方法を1つ考えてみましょう",estimated_seconds:60,difficulty:"medium",content:"今日の作業で時間がかかっている部分を特定し、改善案を考える"}],recommendations:{primary:"学習",balance_suggestion:"健康カテゴリが不足気味です"}},dashboard:{daily_summary:{total_minutes:3,categories_active:["学習","健康"],streak_days:5},weekly_trend:[{date:"2025-09-05",minutes:2},{date:"2025-09-06",minutes:4},{date:"2025-09-07",minutes:3},{date:"2025-09-08",minutes:5},{date:"2025-09-09",minutes:2},{date:"2025-09-10",minutes:3},{date:"2025-09-11",minutes:3}],badges:{continuity:2,challenge:1,balance:3}}};function n(){return a.today}function s(){return a.dashboard}},7982:(e,t,r)=>{r.d(t,{p:()=>i});let a=require("@supabase/supabase-js"),n=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-key",o=process.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-key";(0,a.createClient)(n,s);let i=(0,a.createClient)(n,o,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(4901));module.exports=a})();